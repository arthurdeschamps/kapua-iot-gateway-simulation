# kapua-iot-gateway-simulation
Supply chain management simulator for kapua. The goal is to build a parameterizable simulator for quick tests of the kapua platform.

## Start the simulation
First, you want to run the configuration called **Run All**.
It will start the simulation and the data transmitter at the same time.

Then, you need to start the AngularDart application of the the project
in order to access the UI via localhost on port 63342. In order to do that,
you can open the project in WebStorm and start the configuration named
**index.html**. It can be used either with Dartium (a tweaked version of
Chromium) or with Chrome, but the latter will greatly lack in terms of speed.

A simpler way of starting the whole application will be investigated when
version 1.0 will be ready.  
## Introduction
### Simulation
The simulation uses 3 sub-simulators: **company**, **economy** and **telemetry simulators**. One execution of any of
these 3 simulators corresponds to 1 hour elapsed in _virtual time_.

This _virtual time_ is used to speed up the simulation, since we don't want to
wait a week in front of our computer to see our first order, for example. The
default simulation uses a virtual time 100 times faster than real time, but it will
obviously be customizable via the UI in the long run.

The **company simulator** simulates everything related to the company and also acts as a "customer" simulator.
By using randomness, it triggers _events_ such as gaining or losing a customer, creating a new type of product, 
building products based on a product type, receiving orders from customers, planning deliveries, etc.
These events are heavily correlated to the economy simulator, since their likelihood depends in majority
on its attributes: growth, demand, concurrency, etc.

The **economy simulator** is a simple and purely random-based simulator which fluctuates the parameters defined in the 
**Economy** class.

Last but not least, the **telemetry simulator** reacts to some events triggered
the company and generates data in consequence. For instance, if a delivery goes
from state "warehouse" to "shipping", this simulator will start virtually moving the delivery
towards its destination and update the underlying data (delivery position, transportation
usage, etc)

Aside from the simulation, a service called **DataSenderRunner** is responsible for
periodically sending telemetry data (generated by the telemetry simulator) to Kapua.

Finally, the simulator offers a WebSocket service that can interact with
the frontend, either by answering to non-telemetry data requests or by modifying
the simulation itself via parametrizer-related requests (*this
 latter has not yet been implemented*).

### Data Transmitter
A service called "Data Transmitter" takes care of listening to the Kapua broker
and sends copies of any data sent to Kapua to the frontend application.

It uses MQTT to interact with the broker and WebSocket to send data to 
the UI.


## Project status of advancement
The simulation backbone is almost done, except for the parametrization
that yet can't be done directly from the UI.

Some details will be added and more content will be available in the UI.

##Customize the simulation
In order to fully control the parameters of the simulation, you just
need to check the class `simulation/main/Simulation` 
and modify the *Parametrizer* object, either by instantiating it with every parameter
or by using the default constructor and then set the attributes you want 
to tune.

See `Parametrizer` for more information on how to parametrize
the simulation.

In a close future, the parameters will be customizable directly 
from the UI.

## Technologies
### Languages
Java: Simulation, MQTT + WebSocket services

Dart: AngularDart frontend app

### Test
JUnit with Java

### Build automation tool
Apache Maven

### Package manager
Bower
